{% extends 'base.html' %}

{% block content %}
<div class="container mt-4">
    <h2>{{ session.name }}</h2>
    
    <p>Created on: {{ session.start_date }}</p>
    
    {% if not session.start_date %}
    <a href="{% url 'startsession' session_id=session.id %}"><button>Start Session</button></a>
    {% else %}
    <a href="{% url 'endsession' session_id=session.id %}"><button>End Session</button></a>
    {% endif %}
        
    
    <div class="row">
        <div class="col-md-3">
            <h4>Members</h4>
            <ul class="list-group">
                <li class="list-group-item">
                    {% for member in session.members.all %}
                    <strong>{{ member }}</strong>
                    <ul>    
                        {% for todo in session.todos.all %} 
                        
                        {% if todo.user == member %}
                        <li><button><a href="{% url 'toggletask' task_id=todo.id %}">
                            
                            {% if todo.completed %}
                            ✅
                            {% else %}
                            ⬜
                            {% endif %}
                                
                        </a></button>
                        {{ todo.task }}</li> 
                        {% endif %}
                            
                            
                                
                        {% endfor %}
                            
                        {% endfor %}
                    </ul>
                </li>
            </ul>
        </div>
        
        <div class="col-md-6">
            <div class="chat-box border p-3" style="height: 300px; overflow-y: auto;">
                <h4>Chat Window</h4>
                <div id="chat-messages">
                    {% for message in chat_messages %}
                    <p><strong>{{ message.user }}:</strong> {{ message.text }}</p>
                    {% endfor %}
                </div>
            </div>
            <div class="mt-3">
                <input type="text" id="chat-input" class="form-control" placeholder="Type a message...">
                <button class="btn btn-primary mt-2" onclick="sendMessage()">Send</button>
            </div>
        </div>
        
        <div class="col-md-3">
            <h4>Timer</h4>
            <div class="border p-3 text-center">
                <h5>Deadline</h5>
                <p id="timer">{{ session.finish_date }}</p>
            </div>
        </div>
    </div>
</div>

<h1>Members</h1>

{% for member in session.members.all %}
{{member}} <br>
    
{% endfor %}
    
<a href="{% url 'createtask' session_id=session.id %}">Create Task</a>


<script>
    function sendMessage() {
        let message = document.getElementById("chat-input").value;
        if (message.trim() !== "") {
            let chatBox = document.getElementById("chat-messages");
            chatBox.innerHTML += `<p><strong>You:</strong> ${message}</p>`;
            document.getElementById("chat-input").value = "";
        }
    }
</script>
{% endblock %}

